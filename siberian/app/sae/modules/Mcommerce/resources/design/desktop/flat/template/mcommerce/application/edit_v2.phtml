<?php

use Mcommerce\Form\Store;
use Mcommerce\Form\Settings;

$optionValue = $this->getOptionValue();
$valueId = $optionValue->getId();
$application = $this->getApplication();
$m_commerce = $optionValue->getObject();
$stores = $m_commerce->getStores();

$formStore = new Store();
$formStore->setValueId($valueId);

$formSettings = new Settings();
$formStore->setValueId($valueId);

?>

<div id="mcommerce"
     class="form_content">

    <!-- Nav tabs -->
    <ul class="nav nav-tabs"
        role="tablist">
        <li role="presentation"
            class="active">
            <a href="#tab_stores"
               aria-controls="tab_stores"
               role="tab"
               data-toggle="tab">
                <i class="fa fa-shopping-basket"></i>
                <?php echo p__("m_commerce","Stores") ?>
            </a>
        </li>
        <li role="presentation">
            <a href="#tab_categories"
               aria-controls="tab_categories"
               role="tab"
               data-toggle="tab">
                <i class="fa fa-tags"></i>
                <?php echo p__("m_commerce","Categories") ?>
            </a>
        </li>
        <li role="presentation">
            <a href="#tab_products"
               aria-controls="tab_products"
               role="tab"
               data-toggle="tab">
                <i class="fa fa-shopping-cart"></i>
                <?php echo p__("m_commerce","Products") ?>
            </a>
        </li>
        <li role="presentation">
            <a href="#tab_orders"
               aria-controls="tab_orders"
               role="tab"
               data-toggle="tab">
                <i class="fa fa-truck"></i>
                <?php echo p__("m_commerce","Orders") ?>
            </a>
        </li>
        <li role="presentation">
            <a href="#tab_settings"
               aria-controls="tab_settings"
               role="tab"
               data-toggle="tab">
                <i class="fa fa-cogs"></i>
                <?php echo p__("m_commerce","Settings") ?>
            </a>
        </li>
        <li role="presentation">
            <a href="#tab_design"
               aria-controls="tab_design"
               role="tab"
               data-toggle="tab">
                <i class="fa fa-picture-o"></i>
                <?php echo p__("m_commerce","Design") ?>
            </a>
        </li>
    </ul>

    <div class="tab-content">
        <!-- START CONTACT TAB -->
        <div role="tabpanel"
             class="tab-pane active"
             id="tab_stores">

            <div class="feature-block-add">
                <h3 class="title-editor no-border-radius title-feature-indent">
                    <?php echo p__('m_commerce','Add a store') ?>
                    <button type="button" class="feature-toggle-add toggle_design color-blue pull-right bt-header-right btn">
                        <i class="fa fa-plus"></i>
                    </button>
                </h3>
            </div>

            <div class="feature-block-create"
                 <?php echo ($stores->count() > 0) ? 'style="display: none;"' : ''; ?>>
                <h3 class="title-editor no-border-radius title-feature-indent">
                    <?php echo p__('m_commerce','New store') ?>
                </h3>
                <div class="container-fluid subcontent content-feature">
                    <?php echo $formStore; ?>
                </div>
            </div>

            <?php if ($stores->count() > 0): ?>
                <div class="feature-block-list">
                    <div class="margin-top">
                        <h3 class="title-editor no-border-radius title-feature-indent">
                            <?php echo p__("m_commerce", "Manage stores"); ?>
                            <button type="button" class="toggle_design color-blue pull-right bt-header-right btn feature-toggle-items">
                                <i class="fa fa-angle-down"></i>
                            </button>
                        </h3>
                        <div class="container-fluid first-row-feature content-feature feature-manage-items">
                            <table class="table content-white-bkg sb-pager">
                                <thead>
                                    <tr class="border-grey">
                                        <th style="width:32px;"></th>
                                        <th class="sortable"
                                            style="width:20%;"><?php echo p__("m_commerce", "Title"); ?></th>
                                        <th class="sortable"
                                            style="width:30%;"><?php echo p__("m_commerce","Subtitle"); ?></th>
                                        <th class="sortable"
                                            style="width:30%;"><?php echo p__("m_commerce","Link"); ?></th>
                                        <th style="width:10%;"><?php echo p__("m_commerce","Position") ?></th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody class="feeds-sortable">
                                <?php foreach($stores as $store) : ?>
                                    <tr id="feed_manage_element_<?php echo $store->getId(); ?>"
                                        rel="<?php echo $store->getId(); ?>"
                                        class="feed-manage-element sb-pager feed-container">
                                        <td class="feed-handle"
                                            style="text-align: center;">
                                            <i class="fa fa-sort"></i>
                                        </td>
                                        <td>
                                            <?php echo $store->getName() ?>
                                        </td>
                                    </tr>
                                    <tr class="edit-form"
                                        data-id="feed_<?php echo $store->getId(); ?>"
                                        style="display: none;">
                                        <td colspan="7">
                                            <p class="close-edit"
                                               data-id="feed_<?php echo $store->getId(); ?>">
                                                <i class="fa fa-times"></i><?php echo __("Close") ?>
                                            </p>
                                        </td>
                                    </tr>
                                <?php endforeach; ?>
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            <?php endif; ?>

        </div>
        <!-- END CONTACT TAB -->

        <!-- START SETTINGS TAB -->
        <div role="tabpanel"
             class="tab-pane"
             id="tab_settings">

            <div class="feature-block-add">
                <h3 class="title-editor no-border-radius title-feature-indent">
                    <?php echo p__('m_commerce','Settings') ?>
                </h3>
                <div class="container-fluid first-row-feature content-feature">
                    <?php echo $formSettings; ?>
                </div>
            </div>
        </div>
        <!-- END SETTINGS TAB -->

        <!-- START DESIGN TAB -->
        <div role="tabpanel"
             class="tab-pane"
             id="tab_design">

            <?php echo $this->importBackground($optionValue, false, false); ?>
        </div>
        <!-- END DESIGN TAB -->
</div>

<script type="text/javascript">
    $(document).ready(function () {
        bindForms('#mcommerce');

        $('#delivery_delay').off('change');
        $('#delivery_delay').on('change', function () {
            $.ajax({
                type: 'GET',
                dataType: 'json',
                url: '/mcommerce/application/human-delivery-time/delivery_time/' + $(this).val() + '?t=' + Date.now(),
                success: function (payload) {
                    $('#delivery_delay').parents('.sb-form-line').find('.sb-form-description').text(payload.message);
                }
            });
        });

        var toggleDeliveryOptions = function (show) {
            if (show) {
                $('#store_delivery_options-element').show();
            } else {
                $('#store_delivery_options-element').hide();
            }
        };

        $('#new_delivery_methods-3').off('click');
        $('#new_delivery_methods-3').on('click', function () {
            toggleDeliveryOptions($(this).is(':checked'));
        });

        toggleDeliveryOptions(false);
    });
</script>

<style type="text/css">
    #mcommerce .sb-nav {
        margin-top: 0;
        margin-bottom: 20px;
    }

    #mcommerce dd fieldset legend {
        border-left: 1px solid #c0c0c0;
        background-color: #f0f0f0;
        padding: 4px 15px;
        letter-spacing: 4px;
        margin-bottom: 0;
    }

    #mcommerce dd fieldset dl {
        padding-left: 15px;
        padding-top: 20px;
        border-left: 1px solid #c0c0c0;
    }

    #mcommerce dd fieldset dl .sb-check-container label {
        display: block;
    }

    #mcommerce dd fieldset dl .sb-check-container span.sb-checkbox-label {
        transform: translate(10px, -3px);
        display: inline-block;
    }
</style>